# Chat Room

## TODOs

- client topic class

## Introduction

## Topics

A topic is a variable that is synchronized across all clients. A topic is identified by a string. A topic can be subscribed to by clients. When a topic is updated, all clients subscribed to that topic will receive the update.

The data of a topic can be any JSON-serializable object.

### Special Topics

Special topics starts with `_chatroom/`. They are defined in the ChatRoom library.

* `_chatroom/server_status` - A status string describing the server's nearest event.

* `_chatroom/client_message` - Debug messages (string) to clients. Clients subscribe to `_chatroom/client_message/<id>` to receive debug messages.

## API

All communication is done via a WebSocket connection. Every message has the following format:

```json
{
    "type": "message_type",
    "content": {
        "field1": "value1",
        "field2": "value2",
        ...
    }
}
```

* `type` - The type of message.
* `content` - The actual content of the message.

### Message Types (server -> client)

#### hello

- id : The id of the client.

#### update

- topic : The topic that was updated.
- value : The value that was published.

#### reject_update

- topic : The topic that was rejected.
- change : The change that was rejected.

#### call

- call_id : The id of the call.
- service : The service to call.
- data : The argument to pass to the service.

#### response

- call_id : The id of the call.
- data : The result of the call.

### Message Types (client -> server)

#### try_update : 

- topic : The topic to update.
- change : The change to apply to the topic.

#### subscribe :

- topic : The topic to subscribe to.

#### unsubscribe :

- topic : The topic to unsubscribe from.

#### call :

- call_id : The id of the call. Generated by the client.
- service : The service to call.
- data : The argument to pass to the service.

#### response :

- call_id : The id of the call.
- data : The result of the call.